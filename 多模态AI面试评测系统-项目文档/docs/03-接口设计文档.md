# 接口设计文档

## 多模态智能面试评测系统 API

**文档版本**：v1.0  
**创建日期**：2025年12月  
**API版本**：v1  
**Base URL**：`https://api.interview-ai.com/v1`

---

## 一、接口规范

### 1.1 通用约定

- 数据格式：JSON
- 字符编码：UTF-8
- 时间格式：ISO 8601 (`YYYY-MM-DDTHH:mm:ss.sssZ`)
- 分页参数：`page`（页码，从1开始）、`page_size`（每页数量，默认20）

### 1.2 认证方式

使用 JWT Bearer Token 认证：

```text
Authorization: Bearer <access_token>
```

### 1.3 响应格式

成功响应：

```json
{
    "code": 0,
    "message": "success",
    "data": { ... }
}
```

错误响应：

```json
{
    "code": 40001,
    "message": "错误描述",
    "data": null
}
```

### 1.4 错误码定义

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 40001 | 参数错误 |
| 40101 | 未授权 |
| 40301 | 无权限 |
| 40401 | 资源不存在 |
| 50001 | 服务器内部错误 |

---

## 二、用户模块

### 2.1 用户注册

**POST** `/users/register`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | 是 | 邮箱地址 |
| password | string | 是 | 密码（6-20位） |
| username | string | 是 | 用户名 |
| role | string | 是 | 角色：candidate/enterprise |
| phone | string | 否 | 手机号 |

请求示例：

```json
{
    "email": "user@example.com",
    "password": "password123",
    "username": "张三",
    "role": "candidate",
    "phone": "13800138000"
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "user_id": "u_123456",
        "email": "user@example.com",
        "username": "张三",
        "role": "candidate",
        "created_at": "2025-12-16T10:00:00.000Z"
    }
}
```

### 2.2 用户登录

**POST** `/users/login`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | 是 | 邮箱地址 |
| password | string | 是 | 密码 |

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "token_type": "Bearer",
        "expires_in": 7200,
        "user": {
            "user_id": "u_123456",
            "username": "张三",
            "role": "candidate"
        }
    }
}
```

### 2.3 获取用户信息

**GET** `/users/me`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "user_id": "u_123456",
        "email": "user@example.com",
        "username": "张三",
        "role": "candidate",
        "phone": "13800138000",
        "avatar": "https://example.com/avatar.jpg",
        "created_at": "2025-12-16T10:00:00.000Z"
    }
}
```

### 2.4 刷新Token

**POST** `/users/refresh-token`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| refresh_token | string | 是 | 刷新令牌 |

---

## 三、岗位模块

### 3.1 创建岗位

**POST** `/positions`

权限要求：企业用户

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| title | string | 是 | 岗位名称 |
| category | string | 是 | 岗位类别：ai/bigdata/iot/system |
| description | string | 是 | 岗位描述 |
| requirements | array | 是 | 岗位要求 |
| interview_duration | int | 否 | 面试时长（分钟），默认30 |
| question_count | int | 否 | 题目数量，默认5 |

请求示例：

```json
{
    "title": "算法工程师",
    "category": "ai",
    "description": "负责公司AI算法研发工作",
    "requirements": [
        "熟悉机器学习、深度学习算法",
        "熟练使用Python、PyTorch",
        "有实际项目经验者优先"
    ],
    "interview_duration": 30,
    "question_count": 5
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "position_id": "pos_789012",
        "title": "算法工程师",
        "category": "ai",
        "status": "active",
        "created_at": "2025-12-16T10:00:00.000Z"
    }
}
```

### 3.2 获取岗位列表

**GET** `/positions`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| category | string | 否 | 岗位类别筛选 |
| status | string | 否 | 状态：active/inactive |
| page | int | 否 | 页码 |
| page_size | int | 否 | 每页数量 |

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "total": 100,
        "page": 1,
        "page_size": 20,
        "items": [
            {
                "position_id": "pos_789012",
                "title": "算法工程师",
                "category": "ai",
                "status": "active",
                "interview_count": 50,
                "created_at": "2025-12-16T10:00:00.000Z"
            }
        ]
    }
}
```

### 3.3 获取岗位详情

**GET** `/positions/{position_id}`

---

## 四、题库模块

### 4.1 创建题目

**POST** `/questions`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| position_id | string | 是 | 关联岗位ID |
| content | string | 是 | 题目内容 |
| type | string | 是 | 题目类型：basic/technical/behavioral |
| difficulty | string | 是 | 难度：easy/medium/hard |
| time_limit | int | 否 | 回答时限（秒），默认180 |
| follow_up_enabled | bool | 否 | 是否启用追问，默认true |
| reference_answer | string | 否 | 参考答案 |
| scoring_points | array | 否 | 评分要点 |

请求示例：

```json
{
    "position_id": "pos_789012",
    "content": "请介绍一下你对深度学习的理解，以及你在实际项目中是如何应用的？",
    "type": "technical",
    "difficulty": "medium",
    "time_limit": 180,
    "follow_up_enabled": true,
    "reference_answer": "深度学习是机器学习的一个分支...",
    "scoring_points": [
        "对深度学习概念的理解准确性",
        "实际项目经验的丰富程度",
        "表达的逻辑性和条理性"
    ]
}
```

### 4.2 获取题目列表

**GET** `/questions`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| position_id | string | 否 | 岗位ID筛选 |
| type | string | 否 | 题目类型 |
| difficulty | string | 否 | 难度 |

---

## 五、面试模块

### 5.1 创建面试会话

**POST** `/interviews`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| position_id | string | 是 | 应聘岗位ID |
| interviewer_style | string | 否 | 面试官风格：friendly/serious/pressure |

请求示例：

```json
{
    "position_id": "pos_789012",
    "interviewer_style": "friendly"
}
```

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "interview_id": "int_345678",
        "position_id": "pos_789012",
        "candidate_id": "u_123456",
        "status": "created",
        "interviewer_style": "friendly",
        "room_token": "rtc_token_xxx",
        "questions": [
            {
                "question_id": "q_001",
                "order": 1,
                "content": "请先做一个简单的自我介绍"
            }
        ],
        "created_at": "2025-12-16T10:00:00.000Z"
    }
}
```

### 5.2 开始面试

**POST** `/interviews/{interview_id}/start`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "interview_id": "int_345678",
        "status": "in_progress",
        "current_question": {
            "question_id": "q_001",
            "order": 1,
            "content": "请先做一个简单的自我介绍",
            "time_limit": 120
        },
        "started_at": "2025-12-16T10:05:00.000Z"
    }
}
```

### 5.3 提交回答

**POST** `/interviews/{interview_id}/answers`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| question_id | string | 是 | 题目ID |
| audio_url | string | 是 | 音频文件URL |
| video_url | string | 是 | 视频文件URL |
| transcript | string | 否 | 语音转文本（可由服务端生成） |
| duration | int | 是 | 回答时长（秒） |

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "answer_id": "ans_567890",
        "question_id": "q_001",
        "status": "submitted",
        "next_question": {
            "question_id": "q_002",
            "order": 2,
            "content": "能详细介绍一下你做过的最有挑战性的项目吗？",
            "is_follow_up": false
        }
    }
}
```

### 5.4 获取追问问题

**GET** `/interviews/{interview_id}/follow-up`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| answer_id | string | 是 | 上一个回答ID |

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "follow_up_question": {
            "question_id": "q_001_f1",
            "content": "你提到了使用PyTorch，能具体说说你是如何优化模型训练效率的吗？",
            "is_follow_up": true,
            "parent_question_id": "q_001"
        }
    }
}
```

### 5.5 结束面试

**POST** `/interviews/{interview_id}/end`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "interview_id": "int_345678",
        "status": "completed",
        "total_duration": 1800,
        "questions_answered": 5,
        "report_status": "generating",
        "ended_at": "2025-12-16T10:35:00.000Z"
    }
}
```

### 5.6 获取面试列表

**GET** `/interviews`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| status | string | 否 | 状态筛选 |
| position_id | string | 否 | 岗位筛选 |
| start_date | string | 否 | 开始日期 |
| end_date | string | 否 | 结束日期 |

---

## 六、分析模块

### 6.1 获取实时分析数据

**WebSocket** `/ws/interviews/{interview_id}/analysis`

连接后实时推送分析数据：

```json
{
    "type": "realtime_analysis",
    "timestamp": "2025-12-16T10:10:30.000Z",
    "data": {
        "speech": {
            "emotion": "confident",
            "emotion_score": 0.85,
            "speech_rate": 165,
            "fluency_score": 0.9
        },
        "video": {
            "expression": "neutral",
            "eye_contact_score": 0.75,
            "posture_score": 0.8
        }
    }
}
```

### 6.2 提交音频分析请求

**POST** `/analysis/speech`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| interview_id | string | 是 | 面试ID |
| audio_url | string | 是 | 音频URL |
| analysis_type | array | 是 | 分析类型：asr/emotion/rhythm |

### 6.3 提交视频分析请求

**POST** `/analysis/video`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| interview_id | string | 是 | 面试ID |
| video_url | string | 是 | 视频URL |
| analysis_type | array | 是 | 分析类型：expression/eye_tracking/posture |

---

## 七、报告模块

### 7.1 获取评测报告

**GET** `/reports/{interview_id}`

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "report_id": "rpt_901234",
        "interview_id": "int_345678",
        "candidate": {
            "user_id": "u_123456",
            "username": "张三"
        },
        "position": {
            "position_id": "pos_789012",
            "title": "算法工程师"
        },
        "overall_score": 85,
        "recommendation": "recommend",
        "ability_scores": {
            "professional_knowledge": 88,
            "logical_thinking": 82,
            "language_expression": 86,
            "stress_resistance": 80,
            "communication_potential": 85
        },
        "dimension_details": {
            "speech": {
                "score": 85,
                "speech_rate": "适中",
                "fluency": "良好",
                "emotion": "自信"
            },
            "video": {
                "score": 82,
                "expression": "自然",
                "eye_contact": "良好",
                "posture": "端正"
            },
            "content": {
                "score": 88,
                "relevance": "高",
                "logic_structure": "清晰",
                "professional_depth": "较好"
            }
        },
        "highlights": [
            {
                "timestamp": "00:05:30",
                "type": "positive",
                "description": "对深度学习原理解释清晰，展现扎实的理论基础"
            }
        ],
        "improvements": [
            {
                "dimension": "eye_contact",
                "suggestion": "建议增加与镜头的眼神交流，展现更强的自信"
            },
            {
                "dimension": "answer_structure",
                "suggestion": "建议采用STAR法则组织回答，使表达更有条理"
            }
        ],
        "generated_at": "2025-12-16T10:40:00.000Z"
    }
}
```

### 7.2 获取报告列表

**GET** `/reports`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| position_id | string | 否 | 岗位筛选 |
| min_score | int | 否 | 最低分数 |
| recommendation | string | 否 | 推荐状态 |

### 7.3 导出报告

**GET** `/reports/{interview_id}/export`

查询参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| format | string | 是 | 导出格式：pdf/excel |

---

## 八、文件上传

### 8.1 获取上传凭证

**POST** `/uploads/presign`

请求参数：

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| file_type | string | 是 | 文件类型：audio/video/image |
| file_name | string | 是 | 文件名 |
| content_type | string | 是 | MIME类型 |

响应示例：

```json
{
    "code": 0,
    "message": "success",
    "data": {
        "upload_url": "https://storage.example.com/upload?token=xxx",
        "file_key": "interviews/int_345678/audio_001.wav",
        "expires_in": 3600
    }
}
```

---

## 九、WebSocket事件

### 9.1 面试实时事件

连接地址：`wss://api.interview-ai.com/ws/interviews/{interview_id}`

事件类型：

| 事件类型 | 说明 |
|----------|------|
| connected | 连接成功 |
| question_started | 题目开始 |
| time_warning | 时间提醒 |
| realtime_analysis | 实时分析数据 |
| follow_up_generated | 追问生成 |
| interview_ended | 面试结束 |

---

## 十、SDK示例

### 10.1 Python SDK使用示例

```python
from interview_ai import InterviewClient

# 初始化客户端
client = InterviewClient(
    base_url="https://api.interview-ai.com/v1",
    access_token="your_access_token"
)

# 创建面试会话
interview = client.interviews.create(
    position_id="pos_789012",
    interviewer_style="friendly"
)

# 开始面试
client.interviews.start(interview.id)

# 提交回答
client.interviews.submit_answer(
    interview_id=interview.id,
    question_id="q_001",
    audio_url="https://storage.example.com/audio.wav",
    video_url="https://storage.example.com/video.mp4",
    duration=120
)

# 结束面试并获取报告
client.interviews.end(interview.id)
report = client.reports.get(interview.id)
print(f"综合评分：{report.overall_score}")
```

---

## 附录

### A. 面试官风格说明

| 风格 | 说明 | 特点 |
|------|------|------|
| friendly | 亲和型 | 语气温和，鼓励引导 |
| serious | 严谨型 | 专业严肃，注重细节 |
| pressure | 压力型 | 追问较多，测试抗压 |

### B. 能力维度说明

| 维度 | 英文标识 | 权重 |
|------|----------|------|
| 专业知识水平 | professional_knowledge | 25% |
| 逻辑思维能力 | logical_thinking | 20% |
| 语言表达能力 | language_expression | 20% |
| 应变抗压能力 | stress_resistance | 20% |
| 沟通协作潜力 | communication_potential | 15% |

---

文档修订记录

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| v1.0 | 2025-12 | - | 初稿创建 |
